{"version":3,"sources":["scripts/contentscript.js"],"names":["getEmojiButtons","item","buttonsEle","getElementsByClassName","buttonsJson","Array","prototype","map","call","emoji","getElementsByTagName","alias","getAttribute","score","lastChild","textContent","trim","icon","filter","getCommentsJson","comments","document","index","offsetTop","authorEle","querySelector","author","avatar","anchor","datetime","roleEle","role","buttons","scores","positives","includes","reduce","prev","cur","eyes","id","sortByScoreEyes","anwsers","sort","a","b","rank","arr","_extends","Object","assign","target","i","arguments","length","source","key","hasOwnProperty","debug","name","value","getListItem","className","li","createElement","icons","e","join","roleHtml","slice","innerHTML","isExtLoaded","oldEle","getElementById","start","ask","answers","sidebar","tocContainer","tocHeader","tocBody","askLi","appendChild","tocAnwsers","forEach","old","removeChild","validateUrl","path","window","location","pathname","split","isIssueNo","parseInt","pop","page","isIssues","loop","setInterval","isValid","onload"],"mappings":"AAAA,YAUA,SAASA,iBAAgBC,GACvB,GAAIC,GAAaD,EAAKE,uBAAuB,yBAEzCC,EAAcC,MAAMC,UAAUC,IAAIC,KAAKN,EAAY,SAAUD,GAC/D,GAAIQ,GAAQR,EAAKS,qBAAqB,WAAW,EACjD,KAAKD,EACH,QAEF,IAAIE,GAAQF,EAAMG,aAAa,SAC3BC,EAAQZ,EAAKa,UAAUC,YAAYC,QAAU,EAC7CC,EAAOR,EAAMM,YAAYC,MAE7B,QACEP,MAAOA,EACPI,MAAOA,EACPI,KAAMA,EACNN,MAAOA,KAERO,OAAO,SAAUjB,GAClB,MAAOA,GAAKQ,OAEd,OAAOL,GAGT,QAASe,mBACP,GAAIC,GAAWC,SAASlB,uBAAuB,uBAC/C,OAAOE,OAAMC,UAAUC,IAAIC,KAAKY,EAAU,SAAUnB,EAAMqB,GACxD,GAAIC,GAAYtB,EAAKsB,UACjBC,EAAYvB,EAAKwB,cAAc,UACnC,KAAKD,EACH,QAEF,IAAIE,GAASF,EAAUT,YACnBY,EAAS1B,EAAKwB,cAAc,WAAWb,aAAa,OACpDgB,EAAS3B,EAAKwB,cAAc,iBAAiBb,aAAa,QAC1DiB,EAAW5B,EAAKwB,cAAc,iBAAiBb,aAAa,YAC5DkB,EAAU7B,EAAKwB,cAAc,2BAC7BM,EAAO,EACP9B,GAAKwB,cAAc,6BACrBM,EAAOD,EAAQf,YAAYC,OAG7B,IAAIgB,GAAUhC,gBAAgBC,GAE1BgC,EAASD,EAAQd,OAAO,SAAUjB,GACpC,MAAOiC,WAAUC,SAASlC,EAAKU,SAC9ByB,OAAO,SAAUC,EAAMC,GACxB,OAAQA,EAAIzB,MAAQwB,GACnB,GAECE,EAAOP,EAAQI,OAAO,SAAUC,EAAMC,GACxC,OAAQA,EAAIzB,MAAQwB,GACnB,EAEH,QACEG,GAAIlB,EACJrB,KAAMA,EACNsB,UAAWA,EACXG,OAAQA,EACRC,OAAQA,EACRC,OAAQA,EACRG,KAAMA,EACNF,SAAUA,EACVG,QAASA,EACTC,OAAQA,EACRM,KAAMA,KAKZ,QAASE,iBAAgBC,GACvB,MAAOA,GAAQC,KAAK,SAAUC,EAAGC,GAC/B,MAAID,GAAEX,SAAWY,EAAEZ,SACRW,EAAEX,OAASY,EAAEZ,UAEbW,EAAEL,KAAOM,EAAEN,QAErBhC,IAAI,SAAUN,EAAM6C,EAAMC,GAC3B,MAAOC,aAAa/C,GAClB6C,KAAMA,MAvFZ,GAAIE,UAAWC,OAAOC,QAAU,SAAUC,GAAU,IAAK,GAAIC,GAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,GAAIG,GAASF,UAAUD,EAAI,KAAK,GAAII,KAAOD,GAAcN,OAAO3C,UAAUmD,eAAejD,KAAK+C,EAAQC,KAAQL,EAAOK,GAAOD,EAAOC,IAAY,MAAOL,IAEnPO,MAAQ,SAAeC,EAAMC,KAI7B1B,WAAa,KAAM,OAAQ,QAAS,SAsFpC2B,YAAc,SAAqB5D,EAAM6D,GAC3C,GAAIC,GAAK1C,SAAS2C,cAAc,MAE5BC,EAAQhE,EAAK+B,QAAQzB,IAAI,SAAU2D,GACrC,MAAOA,GAAEjD,KAAO,IAAMiD,EAAErD,QACvBsD,KAAK,KAEJC,EAAWnE,EAAK8B,KAAO,sDAAwD9B,EAAK8B,KAAO,sBAAwB9B,EAAK8B,KAAKsC,MAAM,EAAG,GAAK,SAAW,EAI1J,OAFAN,GAAGO,UAAY,iBAAmBR,EAAY,YAAc7D,EAAKyB,OAAS,WAAazB,EAAK2B,OAAS,kBAAoB3B,EAAKsB,UAAY,2DAA6DtB,EAAK0B,OAAS,kEAAoEsC,EAAQ,yCAA2ChE,EAAKyB,OAAS,2BAA6B0C,EAAW,WAE3XL,GAGLQ,YAAc,WAChB,GAAIC,GAASnD,SAASoD,eAAe,mBACrC,SAASD,GAGPE,MAAQ,WACV,GAAItD,GAAWD,kBAAkBD,OAAO,SAAUjB,GAChD,MAAOA,GAAKyB,QAId,IAFAgC,MAAM,WAAYtC,GAEM,IAApBA,EAASkC,OAAb,CAGA,GAAIqB,GAAMvD,EAAS,GACfwD,EAAUnC,gBAAgBrB,EAASiD,MAAM,IAEzCQ,EAAUxD,SAASoD,eAAe,+BAAiCpD,SAASlB,uBAAuB,sBAAsB,GAEzH2E,EAAezD,SAAS2C,cAAc,MAC1Cc,GAAatC,GAAK,kBAElB,IAAIuC,GAAY1D,SAAS2C,cAAc,MACvCe,GAAUT,UAAY,o1BAEtBS,EAAUvC,GAAK,yBAEf,IAAIwC,GAAU3D,SAAS2C,cAAc,MACrCgB,GAAQxC,GAAK,uBAEb,IAAIyC,GAAQpB,YAAYc,EAAK,YAC7BK,GAAQE,YAAYD,EAEpB,IAAIE,GAAa9D,SAAS2C,cAAc,KACxCmB,GAAW3C,GAAK,cAEhBoC,EAAQQ,QAAQ,SAAUnF,GACxB,GAAI8D,GAAKF,YAAY5D,EACrBkF,GAAWD,YAAYnB,KAGzBiB,EAAQE,YAAYC,GAEpBL,EAAaI,YAAYH,GACzBD,EAAaI,YAAYF,EAEzB,IAAIK,GAAMhE,SAASoD,eAAe,mBAC9BY,IACFR,EAAQS,YAAYD,GAGtBR,EAAQK,YAAYJ,KAGlBS,YAAc,WAChB,GAAIC,GAAOC,OAAOC,SAASC,SACvB5C,EAAMyC,EAAKI,MAAM,KACjBC,IAAcC,SAAS/C,EAAIgD,MAAO,IAClCC,EAAOjD,EAAIgD,MACXE,EAAoB,WAATD,GAA8B,SAATA,CACpC,OAAOH,IAAaI,GAGlBC,KAAO,WACTC,YAAY,WACV,GAAIC,GAAUb,aACVa,KAAY7B,eACdG,SAED,KAGLe,QAAOY,OAAS,WACd,GAAID,GAAUb,aACVa,IACF1B,QAEFwB","file":"contentscript.js","sourcesContent":["'use strict';\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar debug = function debug(name, value) {\n  // console.log(name, value);\n};\n\nvar positives = ['+1', 'tada', 'heart', 'smile'];\n\nfunction getEmojiButtons(item) {\n  var buttonsEle = item.getElementsByClassName('reaction-summary-item');\n\n  var buttonsJson = Array.prototype.map.call(buttonsEle, function (item) {\n    var emoji = item.getElementsByTagName('g-emoji')[0];\n    if (!emoji) {\n      return {};\n    }\n    var alias = emoji.getAttribute('alias');\n    var score = item.lastChild.textContent.trim() || 0;\n    var icon = emoji.textContent.trim();\n\n    return {\n      emoji: emoji,\n      score: score,\n      icon: icon,\n      alias: alias\n    };\n  }).filter(function (item) {\n    return item.emoji;\n  });\n  return buttonsJson;\n}\n\nfunction getCommentsJson() {\n  var comments = document.getElementsByClassName('js-comment-container');\n  return Array.prototype.map.call(comments, function (item, index) {\n    var offsetTop = item.offsetTop;\n    var authorEle = item.querySelector('.author');\n    if (!authorEle) {\n      return {};\n    }\n    var author = authorEle.textContent;\n    var avatar = item.querySelector('.avatar').getAttribute('src');\n    var anchor = item.querySelector('.js-timestamp').getAttribute('href');\n    var datetime = item.querySelector('relative-time').getAttribute('datetime');\n    var roleEle = item.querySelector('.timeline-comment-label');\n    var role = '';\n    if (item.querySelector('.timeline-comment-label')) {\n      role = roleEle.textContent.trim();\n    }\n\n    var buttons = getEmojiButtons(item);\n\n    var scores = buttons.filter(function (item) {\n      return positives.includes(item.alias);\n    }).reduce(function (prev, cur) {\n      return +cur.score + prev;\n    }, 0);\n\n    var eyes = buttons.reduce(function (prev, cur) {\n      return +cur.score + prev;\n    }, 0);\n\n    return {\n      id: index,\n      item: item,\n      offsetTop: offsetTop,\n      author: author,\n      avatar: avatar,\n      anchor: anchor,\n      role: role,\n      datetime: datetime,\n      buttons: buttons,\n      scores: scores,\n      eyes: eyes\n    };\n  });\n}\n\nfunction sortByScoreEyes(anwsers) {\n  return anwsers.sort(function (a, b) {\n    if (a.scores !== b.scores) {\n      return -(a.scores - b.scores);\n    } else {\n      return -(a.eyes - b.eyes);\n    }\n  }).map(function (item, rank, arr) {\n    return _extends({}, item, {\n      rank: rank\n    });\n  });\n}\n\nvar getListItem = function getListItem(item, className) {\n  var li = document.createElement('li');\n\n  var icons = item.buttons.map(function (e) {\n    return e.icon + ' ' + e.score;\n  }).join(' ');\n\n  var roleHtml = item.role ? '<span class=\"toc-divider\"></span>\\n    <div title=\"' + item.role + '\" class=\"toc-role\">' + item.role.slice(0, 1) + '</div>' : '';\n\n  li.innerHTML = '\\n  <a class=\"' + className + '\" title=\"' + item.author + '\" href=\"' + item.anchor + '\" data-offset=\"' + item.offsetTop + '\">\\n    <img class=\"avatar\" width=\"32\" height=\"32\" src=\"' + item.avatar + '\">\\n    <div class=\"toc-detail\">\\n      <div class=\"toc-emoji\">' + icons + '</div>\\n      <div class=\"toc-author\">' + item.author + '</div>\\n    </div>\\n    ' + roleHtml + '\\n  </a>';\n\n  return li;\n};\n\nvar isExtLoaded = function isExtLoaded() {\n  var oldEle = document.getElementById('github-issue-toc');\n  return !!oldEle;\n};\n\nvar start = function start() {\n  var comments = getCommentsJson().filter(function (item) {\n    return item.author;\n  });\n  debug('comments', comments);\n\n  if (comments.length === 0) {\n    return;\n  }\n  var ask = comments[0];\n  var answers = sortByScoreEyes(comments.slice(1));\n\n  var sidebar = document.getElementById('partial-discussion-sidebar') || document.getElementsByClassName('discussion-sidebar')[0];\n\n  var tocContainer = document.createElement('div');\n  tocContainer.id = 'github-issue-toc';\n\n  var tocHeader = document.createElement('div');\n  tocHeader.innerHTML = '<a target=\"_blank\" href=\"https://github.com/wooodhead/github-issue-toc\">\\n  <svg height=\"14\" width=\"32\"  class=\"octicon octicon-mark-github\" viewBox=\"0 0 16 16\" version=\"1.1\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z\"></path></svg>\\n  <span>github-issue-toc</span></a>\\n  ';\n\n  tocHeader.id = 'github-issue-toc-header';\n\n  var tocBody = document.createElement('div');\n  tocBody.id = 'github-issue-toc-body';\n\n  var askLi = getListItem(ask, 'toc-asker');\n  tocBody.appendChild(askLi);\n\n  var tocAnwsers = document.createElement('ul');\n  tocAnwsers.id = 'toc-answers';\n\n  answers.forEach(function (item) {\n    var li = getListItem(item);\n    tocAnwsers.appendChild(li);\n  });\n\n  tocBody.appendChild(tocAnwsers);\n\n  tocContainer.appendChild(tocHeader);\n  tocContainer.appendChild(tocBody);\n\n  var old = document.getElementById('github-issue-toc');\n  if (old) {\n    sidebar.removeChild(old);\n  }\n\n  sidebar.appendChild(tocContainer);\n};\n\nvar validateUrl = function validateUrl() {\n  var path = window.location.pathname;\n  var arr = path.split('/');\n  var isIssueNo = !!parseInt(arr.pop(), 10);\n  var page = arr.pop();\n  var isIssues = page === 'issues' || page === 'pull';\n  return isIssueNo && isIssues;\n};\n\nvar loop = function loop() {\n  setInterval(function () {\n    var isValid = validateUrl();\n    if (isValid && !isExtLoaded()) {\n      start();\n    }\n  }, 2000);\n};\n\nwindow.onload = function () {\n  var isValid = validateUrl();\n  if (isValid) {\n    start();\n  }\n  loop();\n};"]}